## RAG-demo
Java+Milvus,æž„å»ºä¸€ä¸ªragåº”ç”¨
## çŽ¯å¢ƒç‰ˆæœ¬
milvus 2.5.5+jdk 17+aliyun-bailian text-embedding-v3
## ç®€ä»‹
æœ¬é¡¹ç›®é‡‡ç”¨ä¸­å›½åˆ‘æ³•å‘é‡æ•°æ®åº“ä¸­å¯¼å‡ºçš„åç»„æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºæ¨¡æ‹Ÿçš„å‘é‡æ•°æ®ã€‚
æœ¬ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨Milvusæž„å»ºæ³•å¾‹æ¡æ¬¾çš„çŸ¢é‡æ£€ç´¢ç³»ç»Ÿã€‚é€šè¿‡æ–‡æœ¬çš„çŸ¢é‡åŒ–è¡¨ç¤ºï¼Œå®ƒå¯ä»¥å¿«é€Ÿæ£€ç´¢ç±»ä¼¼çš„æ³•å¾‹æ¡æ¬¾ã€‚
ç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„é—®é¢˜è¿”å›žæœ€ç›¸å…³çš„åˆ‘æ³•æ¡æ–‡ã€‚
## åº”ç”¨é…ç½®
#### milvus è¿žæŽ¥
``MilvusServiceClient client = new MilvusServiceClient( ConnectParam.newBuilder().withHost("localhost").withPort(19530).build());``
#### æœºæ¢°æ¨¡åž‹é…ç½® ï¼ˆEmbeddingClient.java,QwenClient.javaï¼‰
``String qwen_api_key = System.getenv("DASHSCOPE_API_KEY");``  
``private static final String API_URL = "https://dashscope.aliyuncs.com/compatible-mode/v1/embeddings";``  
``private final String API_KEY = qwen_api_key; // â† Replace with your actual API Key``
## å¿«é€Ÿå¼€å§‹
#### å¯åŠ¨milvusæœåŠ¡
æŽ¨èdocker
è¯·æ ¹æ®æœ¬æœºçš„çŽ¯å¢ƒåŽ»å¯åŠ¨[milvusæœåŠ¡](https://milvus.io/docs/zh/prerequisite-docker.md)
#### è¿è¡Œç¨‹åºï¼ˆæ”¯æŒideaï¼‰
``javac -cp ".:milvus-xxx-xxx-2.x.x.jar" xxx.java``  
``java -cp ".:milvus-xxx-xxx-2.x.x.jar" xxx`` 
## ç¤ºä¾‹è¾“å‡º
```
âœ… é›†åˆå·²åŠ è½½è¿›å†…å­˜: law_articles
2025-04-15 10:47:04 io.milvus.client.AbstractMilvusGrpcClient logInfo 
INFO: SearchParam{collectionName='law_articles', partitionNames='[]', metricType=L2, target vectors count=1, vectorFieldName='embedding', topK=3, nq=1, expr='', params='{"nprobe": 10}', consistencyLevel='null', ignoreGrowing='false'}
ðŸŽ¯ åŒ¹é…ç»“æžœ:
ID: 457333793497293200
ç›¸ä¼¼åº¦å¾—åˆ†: 0.46925
åŽŸæ–‡: ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬234æ¡ï¼‰: æ•…æ„ä¼¤å®³ä»–äººèº«ä½“çš„ï¼Œå¤„ä¸‰å¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘ã€æ‹˜å½¹æˆ–è€…ç®¡åˆ¶ã€‚è‡´äººé‡ä¼¤çš„ï¼Œå¤„ä¸‰å¹´ä»¥ä¸Šåå¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘ï¼›è‡´äººæ­»äº¡æˆ–é€ æˆä¸¥é‡æ®‹ç–¾çš„ï¼Œå¤„åå¹´ä»¥ä¸Šæœ‰æœŸå¾’åˆ‘ã€æ— æœŸå¾’åˆ‘æˆ–è€…æ­»åˆ‘ã€‚
----------
ðŸŽ¯ åŒ¹é…ç»“æžœ:
ID: 457333793497293212
ç›¸ä¼¼åº¦å¾—åˆ†: 0.46925
åŽŸæ–‡: ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬234æ¡ï¼‰: æ•…æ„ä¼¤å®³ä»–äººèº«ä½“çš„ï¼Œå¤„ä¸‰å¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘ã€æ‹˜å½¹æˆ–è€…ç®¡åˆ¶ã€‚è‡´äººé‡ä¼¤çš„ï¼Œå¤„ä¸‰å¹´ä»¥ä¸Šåå¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘ï¼›è‡´äººæ­»äº¡æˆ–é€ æˆä¸¥é‡æ®‹ç–¾çš„ï¼Œå¤„åå¹´ä»¥ä¸Šæœ‰æœŸå¾’åˆ‘ã€æ— æœŸå¾’åˆ‘æˆ–è€…æ­»åˆ‘ã€‚
----------
ðŸŽ¯ åŒ¹é…ç»“æžœ:
ID: 457333793497293195
ç›¸ä¼¼åº¦å¾—åˆ†: 0.6582297
åŽŸæ–‡: ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬232æ¡ï¼‰: æ•…æ„æ€äººçš„ï¼Œå¤„æ­»åˆ‘ã€æ— æœŸå¾’åˆ‘æˆ–è€…åå¹´ä»¥ä¸Šæœ‰æœŸå¾’åˆ‘ï¼›æƒ…èŠ‚è¾ƒè½»çš„ï¼Œå¤„ä¸‰å¹´ä»¥ä¸Šåå¹´ä»¥ä¸‹æœ‰æœŸå¾’åˆ‘ã€‚
----------
ðŸ¤– AI å›žç­”ï¼š
æ‚¨æ•…æ„ä¼¤å®³ä»–äººèº«ä½“ä¸”æœªå¯¼è‡´æ­»äº¡ï¼Œè§¦çŠ¯äº†ã€Šä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ã€‹ç¬¬234æ¡å…³äºŽæ•…æ„ä¼¤å®³ç½ªçš„è§„å®šã€‚
```
**************************************
ä»¥ä¸Šé’ˆå¯¹RagAppçš„æè¿°å’Œåº”ç”¨å°±ç»“æŸäº†ï¼Œå¦‚æžœä½ æ²¡æœ‰ä½¿ç”¨è¿‡milvusæˆ–å…¶ä»–å‘é‡æ•°æ®åº“ï¼Œå¯ä»¥ç•™æ„MyApp.javaè¯¥åº”ç”¨åªé’ˆå¯¹å¯¹milvusçš„åˆ›å»ºæ’å…¥åˆ é™¤æ£€ç´¢ç­‰å¯¹æ•°æ®åº“çš„åº”ç”¨ã€‚
## æ ¸å¿ƒåŠŸèƒ½è¯´æ˜Ž
#### æ•°æ®ç»“æž„
* id	Int64	ä¸»é”®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
* text	VarChar(512)	æ³•å¾‹æ¡æ–‡æ–‡æœ¬
* embedding	FloatVector	1024ç»´æ–‡æœ¬å‘é‡
#### å…³é”®é…ç½®å‚æ•°
```
// é›†åˆé…ç½®
private static final String COLLECTION_NAME = "test_demo_collection";
private static final String VECTOR_FIELD = "embedding";
private static final int VECTOR_DIM = 1024;  // å¿…é¡»ä¸Ž embedding ç»´åº¦ä¸€è‡´

// æ£€ç´¢å‚æ•°
.withTopK(3)                // è¿”å›žå‰3ä¸ªç»“æžœ
.withMetricType(MetricType.L2)  // ä½¿ç”¨L2è·ç¦»
.withParams("{\"nprobe\": 10}") // æœç´¢ç²¾åº¦å‚æ•°
```
#### MyAppç¤ºä¾‹è¾“å‡º
```
âœ… é›†åˆåˆ›å»ºæˆåŠŸ
âœ… æ’å…¥æ•°æ®è¡Œæ•°: 10
âœ… ç´¢å¼•åˆ›å»ºç»“æžœ: SUCCESS
ðŸ” æ£€ç´¢ç»“æžœæ•°é‡ï¼š3
ðŸ“Œ ID = 5, è·ç¦» = 0.3542, æ–‡æœ¬ = ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬234æ¡ï¼‰...
ðŸ“Œ ID = 2, è·ç¦» = 0.4218, æ–‡æœ¬ = ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬133æ¡ï¼‰...
ðŸ“Œ ID = 9, è·ç¦» = 0.4783, æ–‡æœ¬ = ä¸­åŽäººæ°‘å…±å’Œå›½åˆ‘æ³•ï¼ˆç¬¬299æ¡ï¼‰...
```

#### å‘é‡æ£€ç´¢æµç¨‹
```mermaid
graph TD
    A[è¿žæŽ¥ Milvus] --> B[æ¸…ç†æ—§é›†åˆ]
    B --> C[åˆ›å»ºæ–°é›†åˆ]
    C --> D[ç”Ÿæˆæ–‡æœ¬å‘é‡]
    D --> E[æ’å…¥æ•°æ®]
    E --> F[åˆ›å»ºç´¢å¼•]
    F --> G[åŠ è½½é›†åˆ]
    G --> H[æ‰§è¡Œæ£€ç´¢]
